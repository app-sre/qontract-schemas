---
"$schema": /metaschema-1.json
version: '1.0'
type: object
title: "Application"
description: |
  Schema for defining applications managed by App SRE. This includes details 
  about the application's metadata, dependencies, service owners, escalation 
  policies, and other configurations.

additionalProperties: false
properties:
  "$schema":
    type: string
    enum:
    - /app-sre/app-1.yml
  labels:
    "$ref": "/common-1.json#/definitions/labels"
  name:
    "$ref": "/common-1.json#/definitions/extendedIdentifier"
    description: |
      The unique name of the application.
  product:
    "$ref": "/common-1.json#/definitions/crossref"
    "$schemaRef": "/app-sre/product-1.yml"
    description: |
      Reference to the product associated with the application.
  description:
    type: string
    description: |
      A brief description of the application.
  onboardingStatus:
    type: string
    description: |
      The current onboarding status of the application. This indicates the 
      application's lifecycle stage in the App SRE onboarding process.
    enum:
    - Proposed         # The App is being proposed to be running by the App SRE team
    - InProgress       # The app is currently being on-boarded
    - TransitionPeriod # The app is proving SLI/SLOs for a determined period of time
    - OnBoarded        # The app is fully on-boarded, App SRE are carrying the pager
    - OffBoarding      # The app is being off-boarded
    - BestEffort       # The app is supported on a best effort basis

  grafanaUrls:
    type: array
    description: |
      A list of links to Grafana dashboards or folders associated with the 
      application. Each link should include a title and a URL.
    items:
      type: object
      additionalProperties: false
      required:
      - title
      - url
      properties:
        title:
          type: string
          description: |
            The title of the Grafana dashboard or folder.
        url:
          type: string
          format: uri
          description: |
            The URL of the Grafana dashboard or folder.
      minItems: 1
  sopsUrl:
    type: string
    format: uri
    description: |
      The URL to the Git repository path containing the top-level SOPs for 
      the application.
    pattern: "^https://(?!docs.google.com).*"
  architectureDocument:
    type: string
    format: uri
    description: |
      The URL to the architecture document for the application. This document 
      should provide a detailed explanation of the application's architecture 
      and be accessible to SREs.
  parentApp:
    "$ref": "/common-1.json#/definitions/crossref"
    "$schemaRef": "/app-sre/app-1.yml"
    description: |
      Reference to the parent application, if applicable.
  serviceOwners:
    type: array
    description: |
      A list of teams or individuals responsible for the running instance of 
      the application.
    items:
      type: object
      additionalProperties: false
      properties:
        name:
          type: string
          description: |
            The name of the service owner.
        email:
          type: string
          format: email
          description: |
            The email address of the service owner.
      required:
      - name
      - email
  serviceNotifications:
    type: array
    description: |
      A list of teams or individuals who should receive notifications related 
      to the application.
    items:
      type: object
      additionalProperties: false
      properties:
        name:
          type: string
          description: |
            The name of the notification recipient.
        email:
          type: string
          format: email
          description: |
            The email address of the notification recipient.
      required:
      - name
      - email
  serviceDocs:
    type: array
    description: |
      A list of links to service documentation for the application.
    items:
      type: string
      description: |
        The URL of a service document.
  dependencies:
    type: array
    description: |
      A list of dependencies required by the application.
    items:
      "$ref": "/common-1.json#/definitions/crossref"
      "$schemaRef": "/dependencies/dependency-1.yml"
  gcrRepos:
    type: array
    description: |
      A list of Google Container Registry (GCR) repositories associated with 
      the application.
    items:
      type: object
      additionalProperties: false
      properties:
        project:
          "$ref": "/common-1.json#/definitions/crossref"
          "$schemaRef": "/gcp/project-1.yml"
          description: |
            Reference to the GCP project associated with the repository.
        items:
          type: array
          description: |
            A list of container images in the repository.
          items:
            type: object
            additionalProperties: false
            properties:
              name:
                type: string
                description: |
                  The name of the container image.
              description:
                type: string
                description: |
                  A brief description of the container image.
              public:
                type: boolean
                description: |
                  Indicates whether the container image is public.
              mirror:
                "$schemaRef": "/dependencies/container-image-mirror-1.yml"
                description: |
                  Reference to the mirror configuration for the container image.
            required:
            - name
            - description
            - public
      required:
      - project
      - items
  quayRepos:
    type: array
    description: |
      A list of Quay repositories associated with the application.
    items:
      type: object
      additionalProperties: false
      properties:
        org:
          "$ref": "/common-1.json#/definitions/crossref"
          "$schemaRef": "/dependencies/quay-org-1.yml"
          description: |
            Reference to the Quay organization associated with the repository.
        teams:
          type: array
          description: |
            A list of teams with access to the repository.
          items:
            type: object
            additionalProperties: false
            properties:
              permissions:
                type: array
                description: |
                  A list of permissions assigned to the team.
                items:
                  "$ref": "/common-1.json#/definitions/crossref"
                  "$schemaRef": "/access/permission-1.yml"
              role:
                type: string
                description: |
                  The role assigned to the team.
                enum:
                - read
            required:
            - permissions
            - role
        notifications:
          type: array
          description: |
            A list of notifications configured for the repository.
          items:
            type: object
            additionalProperties: false
            properties:
              event:
                type: string
                description: |
                  The event that triggers the notification.
                enum:
                - vulnerability_found
              severity:
                type: string
                description: |
                  The severity level of the event.
                enum:
                - Defcon 1
                - Critical
                - High
                - Medium
                - Low
                - Negligible
                - Unknown
              method:
                type: string
                description: |
                  The method used to send the notification.
                enum:
                - email
              escalationPolicy:
                "$ref": "/common-1.json#/definitions/crossref"
                "$schemaRef": "/app-sre/escalation-policy-1.yml"
                description: |
                  Reference to the escalation policy for the notification.
              verificationMethod:
                type: object
                description: |
                  The method used to verify the notification.
                additionalProperties: false
                properties:
                  jiraBoard:
                    "$ref": "/common-1.json#/definitions/crossref"
                    "$schemaRef": "/dependencies/jira-board-1.yml"
                    description: |
                      Reference to the Jira board used for verification.
            required:
            - event
            - method
            - escalationPolicy
        items:
          type: array
          description: |
            A list of container images in the repository.
          items:
            type: object
            additionalProperties: false
            properties:
              name:
                type: string
                description: |
                  The name of the container image.
              description:
                type: string
                description: |
                  A brief description of the container image.
              public:
                type: boolean
                description: |
                  Indicates whether the container image is public.
              mirror:
                "$schemaRef": "/dependencies/container-image-mirror-1.yml"
                description: |
                  Reference to the mirror configuration for the container image.
            required:
            - name
            - description
            - public
      required:
      - org
      - items
  endPoints:
    type: array
    description: |
      A list of endpoints exposed by the application.
    items:
      type: object
      additionalProperties: false
      properties:
        name:
          type: string
          description: |
            The name of the endpoint.
        description:
          type: string
          description: |
            A brief description of the endpoint.
        url:
          type: string
          description: |
            The URL of the endpoint.
        monitoring:
          type: array
          description: |
            A list of monitoring configurations for the endpoint.
          items:
            type: object
            additionalProperties: false
            properties:
              provider:
                "$ref": "/common-1.json#/definitions/crossref"
                "$schemaRef": "/dependencies/endpoint-monitoring-provider-1.yml"
                description: |
                  Reference to a monitoring provider for the endpoint.
            required:
            - provider
      required:
      - name
      - description
      - url
  escalationPolicy:
    "$ref": "/common-1.json#/definitions/crossref"
    "$schemaRef": "/app-sre/escalation-policy-1.yml"
    description: |
      Reference to the escalation policy for the application.
  codeComponents:
    type: array
    description: |
      A list of code components associated with the application. Each component 
      represents a repository or resource used by the application.
    items:
      type: object
      additionalProperties: false
      properties:
        name:
          type: string
          description: |
            The name of the code component.
        description:
          type: string
          description: |
            A brief description of the code component.
        resource:
          type: string
          description: |
            The type of resource represented by the code component.
          enum:
          - upstream
          - bundle
          - other
          - gitops
          - infrastructure
        showInReviewQueue:
          type: boolean
          description: |
            Indicates whether merge requests from this repository should be 
            included in the App SRE Review Queue.
        url:
          type: string
          format: uri
          description: |
            The URL of the repository or resource.
        gitlabSync:
          type: object
          description: |
            Configuration for syncing GitLab projects.
          properties:
            sourceProject:
              type: object
              description: |
                The source project for the sync.
              properties:
                name:
                  type: string
                  description: |
                    The name of the source project.
                group:
                  type: string
                  description: |
                    The group of the source project.
                branch:
                  type: string
                  description: |
                    The branch of the source project.
            destinationProject:
              type: object
              description: |
                The destination project for the sync.
              properties:
                name:
                  type: string
                  description: |
                    The name of the destination project.
                group:
                  type: string
                  description: |
                    The group of the destination project.
                branch:
                  type: string
                  description: |
                    The branch of the destination project.
          required:
          - sourceProject
          - destinationProject
        gitlabRepoOwners:
          type: object
          description: |
            Configuration for managing repository owners in GitLab.
          properties:
            enabled:
              type: boolean
              description: |
                Indicates whether repository owners are enabled.
            persistentLgtm:
              type: boolean
              description: |
                Indicates whether persistent LGTM (Looks Good To Me) is enabled.
        gitlabHousekeeping:
          type: object
          description: |
            Configuration for housekeeping tasks in GitLab.
          properties:
            enabled:
              type: boolean
              description: |
                Indicates whether housekeeping tasks are enabled.
            rebase:
              type: boolean
              description: |
                Indicates whether rebasing is enabled.
            days_interval:
              type: integer
              description: |
                The interval in days for housekeeping tasks.
              not:
                enum:
                - 0
            limit:
              type: integer
              description: |
                The limit for housekeeping tasks.
              not:
                enum:
                - 0
            enable_closing:
              type: boolean
              description: |
                Indicates whether closing of merge requests is enabled.
            pipeline_timeout:
              type: integer
              description: |
                The timeout for pipelines in seconds.
            labels_allowed:
              type: array
              description: |
                A list of labels allowed for housekeeping tasks.
              items:
                type: object
                additionalProperties: false
                properties:
                  role:
                    "$ref": "/common-1.json#/definitions/crossref"
                    "$schemaRef": "/access/role-1.yml"
                    description: |
                      Reference to a role associated with the label.
                required:
                - role
            must_pass:
              type: array
              description: |
                A list of tests that must pass before merging.
              items:
                type: string
          required:
          - enabled
          - rebase
        jira:
          "$ref": "/common-1.json#/definitions/crossref"
          "$schemaRef": "/dependencies/jira-server-1.yml"
          description: |
            Reference to the Jira server associated with the code component.
        mirror:
          type: string
          format: uri
          description: |
            The GitLab repository to mirror from.
        imageBuildUrl:
          type: string
          format: uri
          pattern: "^https:\/\/.+(?<!\/)$"
          description: |
            The URL for the component's image build job (e.g., Jenkins job or 
            RHTAP pipeline page).
        managePermissions:
          type: boolean
          description: |
            Indicates whether permissions should be managed on the repository.
        blockedVersions:
          type: array
          description: |
            A list of commit SHAs that should not be promoted.
          items:
            type: string
            pattern: '^[0-9a-f]{40}$'
        hotfixVersions:
          type: array
          description: |
            A list of commit SHAs that should be promoted even without being 
            published successfully to any subscribed channels.
          items:
            type: string
            pattern: '^[0-9a-f]{40}$'
      required:
      - name
      - resource
      - url
  glitchtipProjects:
    type: array
    description: |
      A list of GlitchTip projects associated with the application.
    items:
      "$ref": "/common-1.json#/definitions/crossref"
      "$schemaRef": "/dependencies/glitchtip-project-1.yml"

required:
- "$schema"
- labels
- name
- description
- escalationPolicy
- onboardingStatus
- serviceOwners
- sopsUrl
- architectureDocument
- grafanaUrls
